#!/bin/sh

sudo yum remove -y nodejs npm
sudo yum install -y nodejs npm libgnome-keyring-devel
cd $HOME
npm install npm
export PATH="$HOME/node_modules/.bin:$PATH"
sudo yum -y remove gyp

if [ ! -d /tmp/$USER/atom ]; then
  git clone https://github.com/atom/atom /tmp/$USER/atom
fi
cd /tmp/$USER/atom
git fetch
git checkout $(git describe --tags `git rev-list --tags --max-count=1`)
./script/build

if [ -d /opt/Atom ]; then
  sudo rm -rf /opt/Atom
fi
sudo mv -f /tmp/$USER/atom-build/Atom /opt/
rm -rf $HOME/node_modules
sudo yum remove -y nodejs npm
sudo yum install -y nodejs npm
sudo ln -sf /opt/Atom/resources/app/atom.sh /usr/local/bin/atom
